var AppCalendar = function() {
    return {
        init: function() {


            //cargar todo el schedule que existe en base de datos
            //

            $.ajax({
                url: this.getAbsolutePath() + 'schedules/getApiSchedule',
                type: "GET",
                dataType: "json",
                cache: false,
                data: {},
                success: function(result) {
                    var schedule = result.schedule;
                    var pos;
                    var eve = {};
                    var evento = [];
                    for (pos = 0; pos < schedule.length; pos++) {
                        if (schedule[pos].status == true) {
                            evento.push({
                                'title': schedule[pos].title,
                                'start': schedule[pos].start,
                                'end': schedule[pos].end,
                                'status': schedule[pos].status,
                                'color': schedule[pos].color,
                            });
                        };
                    };
                    eve.events = evento;

                    if (jQuery().fullCalendar) {
                        var e = new Date,
                            t = e.getDate(),
                            a = e.getMonth(),
                            n = e.getFullYear(),
                            r = {};
                        App.isRTL() ? $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = { right: "title, prev, next", center: "", left: "agendaDay, agendaWeek, month, today" }) : ($("#calendar").removeClass("mobile"), r = { right: "title", center: "", left: "agendaDay, agendaWeek, month, today, prev,next" }) : $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = { left: "title, prev, next", center: "", right: "today,month,agendaWeek,agendaDay" }) : ($("#calendar").removeClass("mobile"), r = { left: "title", center: "", right: "prev,next,today,month,agendaWeek,agendaDay" });
                        var l = function(e) {
                                var t = { title: $.trim(e.text()) };
                                e.data("eventObject", t), e.draggable({ zIndex: 999, revert: !0, revertDuration: 0 })
                            },
                            o = function(e) {
                                e = 0 === e.length ? "Untitled Event" : e;
                                var t = $('<div id="' + e + '" class="external-event label label-default">' + e + "</div>");
                                jQuery("#event_box").append(t), l(t)
                            },
                            p = function(array) {
                                var i;
                                for (i = 0; i < array.length; i++) {
                                    if (array[i].status == false) {
                                        array[i].title = 0 === array[i].title.length ? "Untitleds Event" : array[i].title;
                                        var t = $('<div id="' + array[i].title + '" class="external-event label label-default">' + array[i].title + "</div>");
                                        jQuery("#event_box").append(t), l(t)
                                    }
                                }
                            };


                        $("#external-events div.external-event").each(function() { l($(this)) }), $("#event_add").unbind("click").click(function() {
                                var e = $("#event_title").val();
                                o(e);
                                $("#event_title").val('');
                            }),
                            $("#event_box").html(""), p(schedule), $("#calendar").fullCalendar("destroy"), $("#calendar").fullCalendar({
                                header: r,
                                defaultView: "month",
                                slotMinutes: 15,
                                editable: !0,
                                droppable: !0,
                                drop: function(e, t) {
                                    var a = $(this).data("eventObject"),
                                        n = $.extend({}, a);
                                    n.start = e, n.allDay = t, n.className = $(this).attr("data-class"), $("#calendar").fullCalendar("renderEvent", n, !0), $("#drop-remove").is(":checked") && $(this).remove()
                                },
                                events: eve.events
                            })


                    }


                },
                error: function(xhr, ajaxOptions, thrownError) {
                    //console.log("No se ha podido obtener la informacion");
                    //console.log(xhr);
                    //console.log(thrownError);
                }

            });


        },
        getAbsolutePath: function() {
            var loc = window.location;
            var pathName = loc.pathname.substring(0, loc.pathname.lastIndexOf('/') + 1);
            return loc.href.substring(0, loc.href.length - ((loc.pathname + loc.search + loc.hash).length - pathName.length));
        },

    }
}();
jQuery(document).ready(function() { AppCalendar.init() });